---
title: "ps5_Markdown"
author: "Mengqi Shi"
date: "2023-02-13"
output:
  pdf_document: default
  html_document: default
editor_options:
  markdown:
    wrap: 72
---

1 Load and check data (5pt) You first task is to do a very simple data
check: 1. (1pt) For solving the problems, and answering the questions,
create a new rmarkdown docu- ment with an appropriate title. See
<https://faculty.washington.edu/otoomet/info201-book/>
r-markdown.html#r-markdown-rstudio-creating.

```{r}
library(readr)
gapminder <- read_delim("~/Desktop/INFO 201/ps5_Markdown/gapminder.csv")
```

2.  (2pt) Load data. How many rows/columns do we have?

There are `nrow(gapminder)` rows and `ncol(gapminder)` columns.

```{r}
nrow(gapminder)
ncol(gapminder)
```

3.  (2pt) Print a small sample of data. Does it look OK? Yes.

```{r}
head(gapminder, 3)
```

2 Descriptive statistics (15pt) 1. (3pt) How many countries are there in
the dataset? Analyze all three: iso3, iso2 and name.

There are `length(unique(gapminder$iso3))` iso3, `length(unique(gapminder$iso2))` iso2,
`length(unique(gapminder$name))`names.

```{r}
library(dplyr)
length(unique(gapminder$iso3))
length(unique(gapminder$iso2))
length(unique(gapminder$name))
```

2.  If you did this correctly, you saw that there are more names than
    iso-2 codes, and there are even more iso3 -codes. What is going on?
    Can you find it out? The name are not one-on-one, so there are more
    iso3 and iso2 codes.

```{=html}
<!-- -->
```
(a) (5pt) Find how many names are there for each iso-2 code. Are there
    any iso-2 codes that correspond to more than one name? What are
    these countries? Namibia.

```{r}
gapminder%>%
   group_by(iso2, name)%>%
   summarise(result=n(),
          isDubl=ifelse(n()>1,T,F))
```

(b) (5pt) Now repeat the same for name and iso3-code. Are there country
    names that have more than one iso3-code? What are these countries?
    Hint: two of these entitites are CHANISL and NLD CURACAO.

These are CHANISL, GBM, KOS, and NLD CURACAO

```{r}
gapminder%>%
   group_by(iso3, name)%>%
   summarise(result=n(),
          isDubl=ifelse(n()>1,T,F))
```

3.  (2pt) What is the minimum and maximum year in these data? The
    minimum year is `min(gapminder$time, na.rm = TRUE)` and maximum year
    is `max(gapminder$time, na.rm = TRUE)`.

```{r}
min(gapminder$time, na.rm = TRUE)
max(gapminder$time, na.rm = TRUE)
```

3 CO2 emissions (30pt) Next, let's analyze CO2 emissions. 1. (2pt) How
many missing co2 emissions are there for each year? Analyze both missing
CO2 and co2_PC. Which years have most missing data?

```{r}
library(dplyr)
library(tidyverse)
na_count_co2 <- gapminder %>%
  group_by(time) %>%
  summarize(count_na = sum(is.na(co2)))
na_count_co2

na_count_co2PC <- gapminder %>%
  group_by(time) %>%
  summarize(count_na = sum(is.na(co2_PC)))
na_count_co2PC
```

2.  (5pt) Make a plot of total CO2 emissions over time for the U.S,
    China, and India. Add a few more countries of your choice. Explain
    what do you see.

```{r}
library(ggplot2)
gapminder%>%
  filter(name == 'United States of America') %>%
  ggplot(aes(time, co2, color=name)) +
geom_line() +
  theme(text = element_text(size=15))

gapminder%>%
  filter(name == 'China') %>%
  ggplot(aes(time, co2, color=name)) +
geom_line() +
  theme(text = element_text(size=15))

gapminder%>%
  filter(name == 'India') %>%
  ggplot(aes(time, co2, color=name)) +
geom_line() +
  theme(text = element_text(size=15))
```

3.  (5pt) Now let's analyze the CO2 emissions per capita (co2_PC ). Make
    a similar plot of the same countries. What does this figure suggest?

```{r}
library(ggplot2)
gapminder%>%
  filter(name == 'United States of America') %>%
  ggplot(aes(time, co2_PC, color=name)) +
geom_line() +
  theme(text = element_text(size=15))

gapminder%>%
  filter(name == 'China') %>%
  ggplot(aes(time, co2_PC, color=name)) +
geom_line() +
  theme(text = element_text(size=15))

gapminder%>%
  filter(name == 'India') %>%
  ggplot(aes(time, co2_PC, color=name)) +
geom_line() +
  theme(text = element_text(size=15))

```

4.  (6pt) Compute average CO2 emissions per capita across the continents
    (assume region is the same as continent). Comment what do you see.
    Note: just compute averages over countries and ignore the fact that
    countries are of different size. Hint: Americas 2016 should be 4.80.

```{r}
exclude_na <- gapminder %>%
  filter(!is.na(region), !is.na(co2_PC), !is.na(totalPopulation))
exclude_na %>%
  group_by(region,time)%>%
  filter(time == 2016)%>%
  summarize(average = mean(co2_PC))

exclude_na %>%
  group_by(region, time)%>%
  filter(time == 1960)%>%
  summarize(average = mean(co2_PC))
```

5.  (7pt) Make a barplot where you show the previous results--average
    CO2 emissions per capita across continents in 1960 and 2016. Hint:
    it should look something along these lines:

```{r}
data <- as.matrix(data.frame(Africa = c(0.291, 1.22),
                             Americas = c(7.15, 4.80),
                             Asia = c(1.74, 6.47),
                             Europe = c(5.77, 6.64),
                             Oceania = c(2.73, 4.57)))
rownames(data) <- c("1960", "2016")
data
barplot(data,
        col = c("#1B98E0", "#353436"),
        beside = TRUE)
legend("topright",
       legend = c("1960", "2016"),
       fill = c("#1B98E0", "#353436"))
```

6.  Which countries are the three largest, and three smallest CO2
    emitters (in terms of CO2 per capita) in 2019 for each continent?
    (Assume region is continent).

```{r}
##Q6

```

4 GDP per capita (50pt) Let's look at GDP per capita (GDP_PC ). 1. (8pt)
Make a scatterplot of GDP per capita versus life expectancy by country,
using data for 1960. Make the point size dependent on the country size,
and color those according to the continent. Feel free to adjust the plot
in other ways to make it better. Comment what do you see there.

```{r}
library(ggplot2)
gdp_lifeexpectancy <- ggplot(data = subset(gapminder, !is.na(region), !is.na(name)), aes(x = GDP_PC, y = lifeExpectancy, color = region)) + 
  geom_point(aes(size = totalPopulation)) +
  geom_point(alpha = 0.1) +
  xlab("GDP_PC") +
  ylab("life expectancy")
gdp_lifeexpectancy
```

2.  (4pt) Make a similar plot, but this time use 2019 data only.

```{r}
gdp_lifeexpectancy2 <- ggplot(data = filter(gapminder, time == 2019), aes(x = GDP_PC, y = lifeExpectancy, color = region)) + 
  geom_point(aes(size = totalPopulation)) +
  geom_point(alpha = 0.4) +
  xlab("GDP_PC") +
  ylab("life expectancy")
gdp_lifeexpectancy2
```

3.  (6pt) Compare these two plots and comment what do you see. How has
    world developed through the last 60 years?

```{r}
```

4.  (6pt) Compute the average life expectancy for each continent in 1960
    and 2019. Do the results fit with what do you see on the figures?
    Note: here as average I mean just average over countries, ignore the
    fact that countries are of different size.

```{r}
exclude_na_life <- gapminder %>%
  filter(!is.na(region), !is.na(lifeExpectancy))
exclude_na_life %>%
  group_by(region, time)%>%
  filter(time == 1960)%>%
  summarize(average = mean(lifeExpectancy))
exclude_na_life

exclude_na_life %>%
  group_by(region, time)%>%
  filter(time == 2019)%>%
  summarize(average = mean(lifeExpectancy))
exclude_na_life

cat("Q4: Yes")
```

5.  (8pt) Compute the average LE growth from 1960-2019 across the
    continents. Show the results in the order of growth. Explain what do
    you see. Hint: these data (data in long form) is not the simplest to
    compute growth. But you may want to check out the lag() function.
    And do not forget to group data by continent when using lag(),
    otherwise your results will be messed up! See
    <https://faculty.washington>.
    edu/otoomet/info201-book/dplyr.html#dplyr-helpers-compute.

```{r}

```

6.  (6pt) Show the histogram of GDP per capita for years of 1960
    and 2019. Try to put both histograms on the same graph, see how well
    you can do it!

```{r}
plot_data <-
  gapminder %>%
    filter(time == 1960 | time == 2016)

gdp <- ggplot(plot_data, aes(x = GDP_PC, fill = time)) +
  geom_histogram(position = "identity", alpha = 0.4) +
  xlab("GDP_PC")
gdp
```

7.  (6pt) What was the ranking of US in terms of life expectancy in 1960
    and in 2019? (When counting from top.) Hint: check out the function
    rank()! Hint2: 17 for 1960.

The rank in 2019 is 46 and in 1960 is 17
```{r}
gapminder %>%
  filter(time == 2019)%>%
  arrange(lifeExpectancy) %>%
  group_by(name)%>%
  mutate(rank = rank(lifeExpectancy))

gapminder %>%
  filter(time == 1960)%>%
  arrange(lifeExpectancy) %>%
  group_by(name)%>%
  mutate(rank = rank(lifeExpectancy))
```

8.  (6pt) If you did this correctly, then you noticed that US ranking
    has been falling quite a bit. But we also have more countries in
    2019--what about the relative rank divided by the corresponding
    number of countries that have LE data in the corresponding year?
    Hint: 0.0904 for 1960.

```{r}

```
